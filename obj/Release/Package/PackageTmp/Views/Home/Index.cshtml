<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>GoodVibes</title>
    <link rel="stylesheet" type="text/css" href="../css/demos.css" />
    <link rel="stylesheet" type="text/css" href="~/css/w3animation.css" />
    <link rel="stylesheet" type="text/css" href="~/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="~/css/bootstrap-theme.min.css" />


    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,600,400' rel='stylesheet' type='text/css'>

    <link type="text/css" rel="stylesheet" href="../css/jsgrid-theme.min.css" />
    <link rel="stylesheet" type="text/css" href="../css/jsgrid.min.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="../scripts/bootstrap.min.js"></script>

    <script src="../scripts/db.js"></script>
    <script src="../scripts/jsgrid.core.js"></script>
    <script src="../scripts/jsgrid.load-indicator.js"></script>
    <script src="../scripts/jsgrid.load-strategies.js"></script>
    <script src="../scripts/jsgrid.sort-strategies.js"></script>
    <script src="../scripts/jsgrid.field.js"></script>
    <script src="../scripts/jsgrid.field.text.js"></script>
    <script src="../scripts/jsgrid.field.number.js"></script>
    <script src="../scripts/jsgrid.field.select.js"></script>
    <script src="../scripts/jsgrid.field.checkbox.js"></script>
    <script src="../scripts/jsgrid.field.control.js"></script>
</head>

<body class="w3-container w3-center w3-animate-opacity">

    <div id="menubar" style="width:70%; margin-left:15%; margin-top:2.5%; margin-right:15%;">
        <button type="button" data-toggle="modal" data-target="#myModal" style="float:left; width:100px; height:100px;" class="btn btn-primary btn-sm">Add song</button>
        <button type="button" style="float:left; margin-left:5px; width:100px; height:100px;" class="btn btn-primary btn-sm">Delete song</button>
        <button type="button" style="float:left; margin-left:5px; width:100px; height:100px;" class="btn btn-primary btn-sm">Change <br/> playlist</button>

        <button type="button" onclick="player.pauseVideo()" style="float:left; margin-left:5px; width:100px; height:100px;" class="btn btn-primary btn-sm"><span class="glyphicon glyphicon-stop"></span> Stop</button>
        <button type="button" onclick="player.playVideo()"style="float:left; margin-left:5px; width:100px; height:100px;" class="btn btn-primary btn-sm"><span class="glyphicon glyphicon-play"></span> Play </button>


        <button type="button" style="float:right; margin-left:5px; width:100px; height:100px;" class="btn btn-primary btn-sm">Help</button>
        <button type="button" style="float:right; margin-left:5px; width:100px; height:100px;" class="btn btn-primary btn-sm">Fullscreen</button>
        <button type="button" style="float:right; margin-left:5px; width:100px; height:100px;" class="btn btn-primary btn-sm">Show/Hide <br /> Video </button>
    </div>

    <div id="jsGrid" style="margin-left:15%; margin-top:0.5%; max-width:33%; float:left;"></div>
    <div id="player" style="margin-right:15%; margin-top:0.5%; max-width:33%; float:right;"></div>

    <div id="progressBar" style="margin-right:15%; margin-top:0.5%; max-width:33%; float:right;">
        <div></div>
    </div>

    <div class="navbar navbar-default navbar-fixed-bottom">
        <div class="container">
            <p>
                © 2016 - Jarkko Skyttälä

            </p>
        </div>
    </div>

    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Add a song</h4>
                </div>
                <div class="modal-body">
                    <form class="addsongform" name="addsongform" id="addsongform" method="post" role="form">
                        <div class="form-group">
                            <input type="text" name="song_url" class="form-control" id="song_url" placeholder="Enter youtube URL">
                        </div>
                        <div class="form-group">
                            <input type="text" name="song_artist"  class="form-control" id="song_artist" placeholder="Enter song artist">
                        </div>
                        <div class="form-group">
                            <input type="text" name="song_name"  class="form-control" id="song_name" placeholder="Enter song name">
                        </div>
                        <button type="submit" id="addsongform" class="btn btn-default">Add song</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button"  class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    


    <script>

        $(function () {
            $('#addsongform').on('submit', function (e) {
                e.preventDefault();
                $.ajax({
                    url: "../api/insertsong/",
                    type: "POST",
                    data: $("#addsongform").serialize(),
                    success: function(data)
                    {
                        location.reload();
                    },
                    error: function(data)
                    {
                        location.reload();
                    }
                    });
                });
            });
        

        $(function () {
            $("#jsGrid").jsGrid({
                height: "70%",
                width: "75%",
                sorting: true,
                paging: false,

                autoload: true,
                rowClick: function (args) {
                    var $row = this.rowByItem(args.item);
                    $("#jsGrid tr").removeClass("selected-row")
                    $row.addClass("selected-row");
                },
                rowDoubleClick: function (args) {
                    var $row = this.rowByItem(args.item);
                    var val = $row["song_url"];
                    $("#jsGrid tr").removeClass("selected-row")
                    $row.addClass("selected-row");
                    player.loadVideoById(args.item.song_url, 5, 'large');
                },

                controller: {
                    loadData: function () {
                        return $.ajax({
                            type: "GET",
                            url: "../api/getplaylist/JSK",
                            dataType: "json",
                        })
                    }
                },

                fields: [
                    { name: "song_url", type: "text", align: "left", height: 25, width: 200, visible: false },
                    { title: "Artist", name: "song_artist", align: "left", type: "text", width: 200 },
                    { title: "Song name", name: "song_name", align: "left", type: "text", width: 200 },
                    { title: "Date Added", name: "date_created", align: "left", type: "date", width: 150 }
                ]
            });
        });

        function test() {
            var items = $("jsGrid").jsGrid("option", "data");
            alert('herhe');
        }

        function progress(percent, $element) {
            var progressBarWidth = percent * $element.width() / 100;
            $element.find('div').animate({ width: progressBarWidth });
        }

        // 2. This code loads the IFrame Player API code asynchronously.
        var tag = document.createElement('script');

        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // 3. This function creates an <iframe> (and YouTube player)
        //    after the API code downloads.
        var player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '70%',
                width: '75%',
                videoId: '',

                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                },
                playerVars: {
                    'modestbranding': 1,
                    'autoplay': 0,
                    'controls': 0,
                    'rel': 0,
                    'showinfo': 0
                }
            });
        }

        // 4. The API will call this function when the video player is ready.
        function onPlayerReady(event) {
            event.target.playVideo();
        }

        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.ENDED) {
            }
            if (event.data == YT.PlayerState.PLAYING) {

                $('#progressBar').show();
                var playerTotalTime = player.getDuration();

                mytimer = setInterval(function () {
                    var playerCurrentTime = player.getCurrentTime();

                    var playerTimeDifference = (playerCurrentTime / playerTotalTime) * 100;


                    progress(playerTimeDifference, $('#progressBar'));
                }, 1000);
            } else {
                clearTimeout(mytimer);
            }
        }
        function stopVideo() {
            player.stopVideo();
        }
    </script>
</body>
</html>
